您希望后端能够提供准确的周、月、年涨跌幅数据，这完全是一个合理且常见的需求。

简单来说，我们的目标是：

当用户请求某个股票或指数的数据时，除了看到它当前的实时价格和当天的涨跌幅，还能同时看到它**相较于上周末、上月末、以及去年末的涨跌百分比**。

为了做到这一点，后端需要做几件事情：

1.  **获取当前价**：首先，得知道这个股票/指数现在的最新价格是多少。这个通过调用腾讯的实时行情接口就能拿到。
2.  **找到基准点**：这是最关键的一步。
    *   **算周涨幅**：我们需要知道“上周最后一个交易日”它的收盘价是多少。
    *   **算月涨幅**：我们需要知道“上个月最后一个交易日”它的收盘价是多少。
    *   **算年涨幅**：我们需要知道“去年最后一个交易日”它的收盘价是多少。
3.  **获取基准价**：找到了这些“基准日”后，我们就需要去查询这些日子当天的收盘价。这通常通过调用腾讯的历史日K线数据接口来实现。因为我们只需要特定某一天的收盘价，所以日K线数据最合适。
4.  **进行计算**：拿到了“当前价”和各个“基准日的收盘价”后，计算就简单了：
    *   涨跌幅 = (当前价 - 基准价) / 基准价 \* 100%
5.  **提供数据**：最后，把这些计算出来的周、月、年涨跌幅数据，连同其实时数据一起，通过API接口提供给前端或其他调用方。

**挑战与核心**：

*   **准确判断“最后一个交易日”**：因为有周末、有各种法定节假日（比如春节、国庆节），甚至交易所还可能有临时的休市安排，所以不能简单地认为上周末就是上周五，上月末就是那个月的最后一天。我们需要一个可靠的方法（我们之前讨论过的“交易日历服务”）来准确找出这些真正的“最后一个交易日”。
*   **数据获取的可靠性**：网络请求可能会失败，API返回的数据也可能不符合预期。所以，我们的程序需要有错误处理和一定的容错能力。

总的来说，就是“**先定基准日，再查基准价，最后做计算**”这么一个流程。通过结合实时行情接口、历史日K线接口，再加上一个智能的交易日历判断，就能为前端提供准确的周、月、年数据了。

## 1. 实时行情接口 (`qt.gtimg.cn`)

*   **用途:** 获取股票、指数等的实时报价数据。
*   **URL 格式:** `http://qt.gtimg.cn/q=<代码1>,<代码2>,...` (注意: HTTP)
*   **请求方法:** GET
*   **代码格式示例:**
    *   A 股: `sh600519`, `sz000001`
    *   港股: `hk00700`
    *   美股: `usAAPL` (注意: 直接使用 Ticker, 无需 `.OQ` 或 `.N` 后缀)
    *   指数: `sh000001`
*   **特点:**
    *   返回 **GBK/GB2312** 编码的字符串。
    *   每个代码对应一行，以分号 `;` 结尾。
    *   行内字段使用波浪号 `~` 分隔。
    *   支持批量查询，但有数量限制，且遇到无效代码会中断。
    *   不同市场返回的字段数量和含义存在差异。

示例：https://qt.gtimg.cn/q=sh600519 
返回值：v_sh600519="1~贵州茅台~600519~1553.85~1550.20~1570.00~16216~7599~8617~1553.85~9~1552.46~1~1552.44~3~1552.23~1~1552.22~1~1554.00~10~1554.10~1~1554.13~4~1554.17~1~1554.33~1~~20250507120507~3.65~0.24~1570.00~1550.20~1553.85/16216/2526329063~16216~252633~0.13~21.93~~1570.00~1550.20~1.28~19519.43~19519.43~7.56~1705.22~1395.18~1.74~-2~1557.91~18.18~22.64~~~0.95~252632.9063~0.0000~0~ ~GP-A~1.96~0.25~3.52~34.45~29.53~1886.12~1221.95~-0.77~-0.96~9.98~1256197800~1256197800~-6.25~14.12~1256197800~~~-9.41~0.03~~CNY~0~___D__F__N~1552.00~6";

## 2. 历史 K 线接口 (`web.ifzq.gtimg.cn`)

---

腾讯的历史数据接口不需要使用cookie，因此使用XMLHTTP也可以成功获取数据。


param参数说明  

第1个参数：代码。A股为sh000000（上交所）或sz000000（深交所）；港股为hk00000；美股为us+美股代码+后缀，纳斯达克交易所股票加后缀OQ，纽交所股票加后缀N，美交所后缀加AM  

第2个参数：周期。day为日，week为周，month为月...

第3个参数：开始日期。可设置为空  

第4个参数：结束日期。值为空的时候以最近周期为结束日期

第5个参数：周期数。当周期数小于开始日期至结束日期之间周期数，则返回结束日期前N个周期的数据。当周期数大于开始日期至结束日期之间周期数，仍返回开始日期至结束日期之间的数据。  

第6个参数：qfq表示前复权
**前复权：**  

A股：  

https://web.ifzq.gtimg.cn/appstock/app/fqkline/get?param=sh600000,month,2024-01-01,2024-09-30,12,qfq


港股：

https://web.ifzq.gtimg.cn/appstock/app/hkfqkline/get?param=hk00700,month,2024-01-01,2024-09-30,12,qfq



美股：  

https://web.ifzq.gtimg.cn/appstock/app/usfqkline/get?param=usJD.OQ,month,2024-01-01,2024-09-30,12,qfq


